<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Leaflet Maps with OpenStreetMap</title>
    <!-- Include Leaflet CSS and JavaScript -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- Include Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <style>
        body {
            overflow: hidden;
            /* Locks the entire screen from scrolling */
        }

        #map {
            height: 98vh;
            width: 100%;
            z-index: 0;
        }

        #button-container {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
        }

        .button {
            padding: 10px 20px;
            background-color: #bebebe;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }

        /* Keep the old style for the footer popup */
        .footer-popup {
            border-radius: 10px 10px 0 0;
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            width: auto;
            background-color: rgb(201, 201, 201);
            padding: 20px;
            border-top: 1px solid #ccc;
            transition: bottom 0.5s ease;
            z-index: 1000px;
            height: 300px;
        }

        .show-popup {
            bottom: 0;
        }

        .popup-content {
            position: relative;
            padding-bottom: 40px;

        }

        .btn-google-maps {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
        }

        .suggestion {
            cursor: pointer;
            padding: 5px;
            background-color: #f0f0f0;
            /* Background color for suggestions */
            border-radius: 5px;
            /* Rounded corners for suggestions */
            margin-bottom: 5px;
            /* Add margin between suggestions */
        }

        .suggestion:hover {
            background-color: #e0e0e0;
            /* Background color for suggestions on hover */
        }
    </style>

    <style>
        .popup-tab {
            padding: 5px 10px;
            /* Increased padding for larger buttons */
            background-color: #007bff;
            /* Blue color for buttons */
            color: white;
            border: none;
            /* Remove border */
            border-radius: 25px;
            /* Rounded corners */
            cursor: pointer;
            margin-right: 10px;
            /* Add margin between buttons */
            font-size: 14px;
            /* Adjust font size for better readability */
        }
    </style>
    <style>
        #description-content {
            display: flex;
            align-items: center;
        }

        #description-content .popup-image-title {
            display: flex;
            align-items: center;
        }

        #description-content .popup-image-title img {
            max-width: 60px;
            vertical-align: middle;
            margin-right: 5px;
            /* Add margin to separate the image and buttons */
        }
    </style>
    <style>
        .btn-google-maps {
            display: inline-block;
            padding: 0;
            width: 60px;
            /* Adjust the width and height to your desired button size */
            height: 60px;
            background-color: #000000;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .btn-google-maps img {
            width: 30px;
            /* Set the image width to half of the button's width */
            height: 45px;
            /* Set the image height accordingly */
            /* Ensure the image retains a circular shape */
            margin: 15px;
            /* Center the image within the button */
        }


        .btn-google-maps:hover {
            background-color: #3b79db;
            /* Darker shade of Google blue on hover */
        }

        .btn-google-maps:focus {
            outline: none;
            /* Remove outline on focus */
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div id="button-container" class="d-flex flex-column align-items-center">
        <form id="search-form"> <!-- Add the search form -->
            <select id="search-input" class="form-select mb-2" aria-label="Search by title">
                <option value="" selected disabled>Select station</option>
            </select>
            <select id="service-select" class="form-select mb-2" aria-label="Search by service">
                <option value="" selected disabled>Select service</option>
                <option value="all">Show all</option>
                <option value="ABA">ABA</option>
                <option value="Fleet card">Fleet card</option>
                <option value="Cash">Cash</option>
                <!-- Add more options as needed -->
            </select>
            <button type="submit" class="button mb-2">Search</button> <!-- Add a search button -->
        </form>
        <button id="find-location-button" class="button mb-2">My Location</button>
        <!-- <button id="filter-button" class="button">Filter</button> -->
        <button id="zoom-button" class="button mt-2">Zoom</button>
        <div id="suggestions"></div>
        <!-- Suggestions container -->
    </div>
    <!-- Popup for marker information -->

    <div id="popup" class="footer-popup">
        <div class="popup-header">
            <div class="popup-content">
                <a href="#" class="btn btn-primary btn-google-maps">
                    <img src="#" alt="Image Alt Text">
                </a>
            </div>

            <img src="./pictures/logo_Station.png" style="max-width: 100px" />
            <i id="close-button" class="fa fa-times-circle"
                style="margin-left:60%; color: red; font-size: 24px; cursor: pointer;"></i>
        </div>
        <hr />
        <div class="popup-content" style="overflow-y: auto; height:200px;">
            <div class="popup-image-title">
                <img id="marker-image" src="" alt="Marker Image"
                    style="max-width: 100px; vertical-align: middle; border-radius: 20px;" />

                <button id="title-tab" class="popup-tab">Station</button>
                <button id="description-tab" class="popup-tab">Service</button>
                <button id="service-tab" class="popup-tab">Payment</button>
            </div>
            <hr />
            <div id="title-content">
                <h3>Title:</h3>
                <div id="product-content" style="display: flex; align-items: center;">
                    <div class="popup-image-title">
                        <!-- Display the first product image -->
                        <img id="product-image-1" src="" alt="Marker Image"
                            style="max-width: 60px; vertical-align: middle; margin-right: 5px;" />
                        <!-- Display the second product image -->
                        <img id="product-image-2" src="" alt="Marker Image"
                            style="max-width: 60px; vertical-align: middle; margin-right: 5px;" />
                    </div>
                </div>
                <div id="other-product-content" style="display: flex; align-items: center;">
                    <div class="popup-image-title">
                        <!-- Display the first other product image -->
                        <img id="other-product-image-1" src="" alt="Marker Image"
                            style="max-width: 60px; vertical-align: middle; margin-right: 5px;" />
                        <!-- Display the second other product image -->
                        <img id="other-product-image-2" src="" alt="Marker Image"
                            style="max-width: 60px; vertical-align: middle; margin-right: 5px;" />
                    </div>
                </div>
            </div>



            <div id="description-content" style="display: flex; align-items: center;">
                <div class="popup-image-title">
                    <!-- Display the first image -->
                    <img id="description-image-1" src="" alt="Marker Image"
                        style="max-width: 60px; vertical-align: middle; margin-right: 5px;" />
                    <!-- Display the second image -->
                    <img id="description-image-2" src="" alt="Marker Image"
                        style="max-width: 60px; vertical-align: middle; margin-right: 5px;" />
                </div>
            </div>



            <div id="service-content" style="display: flex; align-items: center;">
                <div class="popup-image-title">
                    <img src="pictures/payment_image.png" alt="Marker Image"
                        style="max-width: 60px; vertical-align: middle;" />
                    <h2 style="display: inline-block; margin-left: 5px;">
                        <div id="service-buttons"></div>
                    </h2>

                </div>
            </div>



        </div>
    </div>

    <script>
        var map;
        var popup = document.getElementById("popup");
        var markers = []; // Array to store all markers
        var suggestionsContainer = document.getElementById("suggestions");
        var selectInput = document.getElementById("search-input");

        function loadMapScenario() {
            // Initialize Leaflet map
            map = L.map("map", {
                zoomControl: false, // Disable default zoom control
            }).setView([12.5657, 104.991], 7);

            // Add OpenStreetMap tile layer to the map
            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
                maxZoom: 19,
                attribution:
                    '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            }).addTo(map);

            // Automatically find user's location
            findMyLocation();

            // Fetch marker data from JSON file
            fetch("data/markers.json")
                .then((response) => response.json())
                .then((markerData) => {
                    markerData.STATION.forEach((marker) => {
                        var loc = [marker.latitude, marker.longitude];

                        // Define the custom icon URL for the marker
                        var customIconUrl = "./pictures/6.png";

                        // Create a custom icon
                        var customIcon = L.icon({
                            iconUrl: customIconUrl,
                            iconSize: [50, 75], // Adjust icon size as needed
                            iconAnchor: [24, 75], // Adjust anchor position if needed
                            popupAnchor: [0, -1000], // Adjust popup anchor if needed
                        });

                        // Create a marker with custom icon
                        var customMarker = L.marker(loc, {
                            icon: customIcon,
                            title: marker.title,
                            service: marker.service,
                        }).addTo(map);
                        markers.push(customMarker); // Add marker to the markers array

                        // Add option to select input
                        var option = document.createElement("option");
                        option.textContent = marker.title;
                        option.value = marker.title;
                        selectInput.appendChild(option);

                        // Inside the click event listener for the marker
                        // Inside the click event listener for the marker
                        // Inside the click event listener for the marker
                        customMarker.on("click", function (e) {
                            // Set popup content dynamically from marker data
                            popup.querySelector(".popup-header img").src = "./pictures/Google_Maps_icon.png";
                            document.getElementById("marker-image").src = "pictures/" + marker.picture;

                            // Set default tab to "Title" when marker is clicked
                            document.getElementById("title-tab").click();

                            // Set content for the title and product
                            document.getElementById("title-content").innerHTML = "<div id='title-and-product' style='display: flex; align-items: center;'><h3>Station: " + marker.title + "</h3>";

                            var titleContent = document.createElement("div");
                            titleContent.innerHTML = "<h3>Product</h3>";
                            document.getElementById("title-content").appendChild(titleContent);
                            var productContent = document.createElement("div");
                            productContent.style.display = "flex";
                            productContent.style.alignItems = "center";
                            marker.product.forEach(function (product) {
                                var imgSrc = ''; // Default empty image source
                                if (product === "HSD") {
                                    imgSrc = "pictures/HSD.png"; // Set image source for HSD
                                } else if (product === "ULG 95") {
                                    imgSrc = "pictures/ULG95.png"; // Set image source for ULG 95
                                } else if (product === "ULR 91") {
                                    imgSrc = "pictures/ULR91.png"; // Set image source for ULR 91
                                }
                                // Append image tag with the corresponding source
                                productContent.innerHTML += '<img src="' + imgSrc + '" alt="' + product + '" style="max-width: 60px;padding:10px; vertical-align: middle; margin-right: 5px;border-radius: 50%;" />';
                            });
                            document.getElementById("title-content").appendChild(productContent);
                            document.getElementById("title-content").innerHTML += "</div>";

                            // Add other product content
                            var otherProductContent = document.createElement("div");
                            otherProductContent.innerHTML = "<h3>Other Product</h3>";
                            document.getElementById("title-content").appendChild(otherProductContent);
                            var otherProductImages = document.createElement("div");
                            otherProductImages.style.display = "flex";
                            otherProductImages.style.alignItems = "center";
                            marker.other_product.forEach(function (otherProduct) {
                                var imgSrc = ''; // Default empty image source
                                if (otherProduct === "EV") {
                                    imgSrc = "pictures/EV.png"; // Set image source for EV
                                } else if (otherProduct === "Onion") {
                                    imgSrc = "pictures/onion.png"; // Set image source for ULG 98
                                }
                                // Append image tag with the corresponding source
                                otherProductImages.innerHTML += '<img src="' + imgSrc + '" alt="' + otherProduct + '" style="max-width: 60px; vertical-align: middle; margin-right: 5px; padding:10px;"  />';
                            });
                            document.getElementById("title-content").appendChild(otherProductImages);
                            document.getElementById("title-content").innerHTML += "</div>";

                            document.getElementById("description-content").innerHTML = "<p>Description: " + marker.description.join(", ") + "</p>";
                            var directionsButton = popup.querySelector('.popup-content a');
                            directionsButton.setAttribute('onclick', `openGoogleMaps(${marker.latitude}, ${marker.longitude})`);

                            // Display service buttons dynamically
                            var serviceButtons = document.getElementById("service-buttons");
                            serviceButtons.innerHTML = ""; // Clear previous buttons
                            marker.service.forEach(function (service) {
                                var button = document.createElement("button");
                                button.textContent = service;
                                // Set different colors based on the service
                                if (service === "Fleet card") {
                                    button.classList.add("btn-fleetcard");
                                } else if (service === "ABA") {
                                    button.classList.add("btn-aba");
                                } else if (service === "Cash") { // Add condition for "cash"
                                    button.classList.add("btn-cash"); // Add class "btn-cash" for "cash" service
                                } else {
                                    button.classList.add("btn-default");
                                }

                                serviceButtons.appendChild(button);
                            });

                            // Display description images dynamically
                            var descriptionContent = document.getElementById("description-content");
                            var descriptionImages = '';
                            marker.description.forEach(function (description) {
                                var imgSrc = ''; // Default empty image source
                                if (description === "7-Eleven") {
                                    imgSrc = "pictures/7eleven.png"; // Set image source for 7-Eleven
                                    // Append image tag with the corresponding source
                                    descriptionImages += '<img src="' + imgSrc + '" alt="' + description + '" style="max-width: 60px;padding:10px; vertical-align: middle; margin-right: 5px;" />';
                                } else if (description === "Amazon") {
                                    imgSrc = "pictures/amazon.png"; // Set image source for Amazon
                                    // Append image tag with the corresponding source
                                    descriptionImages += '<img src="' + imgSrc + '" alt="' + description + '" style="max-width: 60px; padding:10px;vertical-align: middle; margin-right: 5px;" />';
                                }
                            });
                            // Set the HTML content of the description content div
                            descriptionContent.innerHTML = descriptionImages;

                            // Display the popup with animation
                            popup.classList.add("show-popup");
                        });



                        // Add click event listeners for each tab
                        document.getElementById("title-tab").addEventListener("click", function () {
                            document.getElementById("title-content").style.display = "block";
                            document.getElementById("description-content").style.display = "none";
                            document.getElementById("service-content").style.display = "none";
                        });
                        document.getElementById("description-tab").addEventListener("click", function () {
                            document.getElementById("title-content").style.display = "none";
                            document.getElementById("description-content").style.display = "block";
                            document.getElementById("service-content").style.display = "none";
                        });
                        document.getElementById("service-tab").addEventListener("click", function () {
                            document.getElementById("title-content").style.display = "none";
                            document.getElementById("description-content").style.display = "none";
                            document.getElementById("service-content").style.display = "block";
                        });



                    });
                })
                .catch((error) => console.error("Error loading marker data:", error));

            // Add click event listener to close button
            document
                .getElementById("close-button")
                .addEventListener("click", function (event) {
                    event.stopPropagation(); // Prevent click event from propagating to popup
                    popup.classList.remove("show-popup");
                });

            // Add change event listener to select input
            selectInput.addEventListener("change", function (event) {
                var selectedTitle = event.target.value;
                if (selectedTitle) {
                    var targetMarker = markers.find(
                        (marker) => marker.options.title === selectedTitle
                    );
                    if (targetMarker) {
                        map.setView(targetMarker.getLatLng(), 15); // Zoom to the marker if found
                    }
                }
            });


            // Add click event listener to find location button
            document
                .getElementById("find-location-button")
                .addEventListener("click", function () {
                    findMyLocation();
                });

            // Add click event listener to zoom button
            document
                .getElementById("zoom-button")
                .addEventListener("click", function () {
                    var selectedTitle = selectInput.value;
                    if (selectedTitle) {
                        var targetMarker = markers.find(
                            (marker) => marker.options.title === selectedTitle
                        );
                        if (targetMarker) {
                            map.setView(targetMarker.getLatLng(), 15); // Zoom to the marker if found
                        }
                    }
                });


       // Add submit event listener to search form
       document.getElementById("search-form").addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent default form submission behavior
    
        var selectedService = document.getElementById("service-select").value.toLowerCase(); // Retrieve selected service
    
        markers.forEach(function (marker) {
            var markerServices = marker.options.service.map(service => service.toLowerCase()); // Retrieve marker services
    
            // Check if marker's services include the selected service
            if (selectedService === "" || markerServices.includes(selectedService)) {
                marker.addTo(map); // Show marker if service matches selected service or no service is selected
            } else {
                map.removeLayer(marker); // Hide marker if service does not match selected service
            }
        });
    });
    
document.getElementById("search-form").addEventListener("submit", function (event) {
    event.preventDefault(); // Prevent default form submission behavior

    var selectedService = document.getElementById("service-select").value.toLowerCase(); // Retrieve selected service

    markers.forEach(function (marker) {
        if (selectedService === "all" || marker.options.service.toLowerCase() === selectedService) {
            marker.addTo(map); // Show marker if "Show all" is selected or if marker's service matches the selected service
        } else {
            map.removeLayer(marker); // Hide marker if service does not match selected service
        }
    });
});


            // Add zoom control to the bottom right corner
            L.control.zoom({ position: "bottomright" }).addTo(map);
        }

        function findMyLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        var latlng = [
                            position.coords.latitude,
                            position.coords.longitude,
                        ];

                        // Add a new marker at the user's location
                        var userMarker = L.marker(latlng, { color: "red" }).addTo(map);

                        // Set map view to user's location with zoom level
                        map.setView(latlng, 15);
                    },
                    function (error) {
                        console.error("Error getting the user location:", error);
                    }
                );
            } else {
                console.error("Geolocation is not supported by this browser.");
            }
        }

        // Load Leaflet map when the window is loaded
        window.onload = loadMapScenario;

        function openGoogleMaps(lat, lon) {
            var url =
                "https://www.google.com/maps/dir/?api=1&destination=" +
                lat +
                "," +
                lon;
            window.open(url, "_self");
        }
    </script>
    <style>
        .btn-fleetcard,
        .btn-cash,
        .btn-aba,
        .btn-default {
            background-color: #444744;
            /* Blue color for fleetcard */
            color: white;
            border-radius: 20px;
            /* Increased border-radius for rounder buttons */
            padding: 12px 24px;
            /* Increased padding for larger buttons */
            font-size: 16px;
            /* Adjust font size for better readability */
            border: none;
            /* Remove border for cleaner appearance */
            cursor: pointer;
            margin-right: 10px;
            /* Add margin between buttons */
            margin-bottom: 10px;
            /* Add margin between buttons and other elements */
        }

        .btn-aba {
            background-color: #1d3a8a;
            /* Green color for ABA */
        }

        .btn-fleetcard {
            background-color: #62db11;
            /* Grey color for other services */
        }
    </style>



</body>

</html>